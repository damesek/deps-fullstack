{"version":3,"sources":["sci/impl/utils.cljc"],"mappings":"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","names":["cljs.core.derive","sci.impl.utils/constant?","x","cljs.core/Keyword","cljs.core/boolean?","sci.impl.utils/kw-identical?","cljs.core/keyword-identical?","var_args","G__51478","sci.impl.utils/throw-error-with-location","js/Error","msg","iobj","sci.impl.utils.throw_error_with_location","data","map__51482","cljs.core/--destructure-map","line","cljs.core.get","column","file","cljs.core/deref","sci.impl.vars/current-file","cljs.core/meta","cljs.core.ex_info","cljs.core.merge","sci.impl.utils/*in-try*","sci.impl.utils/macro?","f","temp__5804__auto__","m","or__5045__auto__","sci.impl.utils/needs-ctx","cljs.core.symbol","sci.impl.utils/allowed-append","G__51498","sci.impl.utils/rethrow-with-location-of-node","ctx","e","raw-node","sci.impl.utils.rethrow_with_location_of_node","bindings","stack","sci.impl.types/stack","node","sci.impl.types/sexpr","cljs.core/seqable?","cljs.core/first","fm","G__51508","env","id","d","cljs.core/ex-data","st","cljs.core/volatile!","cljs.core/-vreset!","cljs.core/-deref","cljs.core.conj","wrapping-sci-error?","cljs.core.isa_QMARK_","map__51515","ex-msg","G__51516","cljs.core/last","and__5043__auto__","clojure.string/replace","new-exception","new-d","sci.impl.utils/iobj?","obj","cljs.core/PROTOCOL_SENTINEL","args__5775__auto__","len__5769__auto__","i__5770__auto__","argseq__5776__auto__","cljs.core/IndexedSeq","sci.impl.utils/vary-meta*","seq51538","G__51539","cljs.core/next","G__51540","self__5754__auto__","args","cljs.core.apply","cljs.core/vary-meta","sci.impl.utils/strip-core-ns","sym","G__51543","cljs.core/namespace","cljs.core/name","sci.impl.utils/allowed-loop","sci.impl.utils/allowed-recur","sci.impl.utils/walk*","inner","form","cljs.core/list?","cljs.core/with-meta","cljs.core/list","cljs.core.map","cljs.core/map-entry?","cljs.core/MapEntry","G__51545","cljs.core/key","G__51547","cljs.core/val","cljs.core/seq?","cljs.core.doall","cljs.core/record?","cljs.core.reduce","r","cljs.core/coll?","cljs.core.into","cljs.core/empty","sci.impl.utils/prewalk","cljs.core.partial","sci.impl.utils/namespace-object","ns-sym","create?","attr-map","env*","ns-map","cljs.core.get_in","ns-obj","sci.impl.vars/->SciNamespace","cljs.core.swap_BANG_","cljs.core/assoc-in","sci.impl.utils/set-namespace!","sci.impl.vars/current-ns","sci.impl.utils/eval-form-state","sci.impl.utils/eval-require-state","sci.impl.utils/eval-use-state","sci.impl.utils/eval-resolve-state","sci.impl.utils/eval-refer-state","sci.impl.utils/macroexpand*","sci.impl.utils/macroexpand-1*","sci.impl.utils/eval*","sci.impl.utils/eval-do*","sci.impl.utils/eval-fn","sci.impl.utils/eval-string*","sci.impl.utils/lookup","sci.impl.utils/eval","sci-ctx","fexpr__51554","sci.impl.utils/split-when","pred","coll","cljs.core/LazySeq","s","cljs.core/seq","fst","cljs.core/complement","run","cljs.core/cons","p1__51556#","cljs.core.take_while","G__51557","G__51558","cljs.core.drop","cljs.core/count","sci.impl.utils/ana-macros","G__51561","sci.impl.utils/ctx-fn","expr","sci.impl.types/->EvalFn","sci.impl.utils/maybe-destructured","params","body","cljs.core/every?","cljs.core/symbol?","new-params","lets","cljs.core.sequence","cljs.core.concat","cljs.core/List","cljs.core/Symbol","gparam","cljs.core.gensym","sci.impl.utils/log","seq51569","self__5755__auto__","xs","js/console","clojure.string.join"],"sourcesContent":["(ns sci.impl.utils\n  {:no-doc true}\n  (:refer-clojure :exclude [eval])\n  (:require [clojure.string :as str]\n            [sci.impl.types :as t]\n            [sci.impl.vars :as vars]))\n\n#?(:clj (set! *warn-on-reflection* true))\n\n(derive :sci.error/realized-beyond-max :sci/error)\n(derive :sci.error/parse :sci/error)\n\n(defn constant? [x]\n  (or (number? x) (string? x) (keyword? x) (boolean? x)))\n\n(def kw-identical? #?(:clj identical? :cljs keyword-identical?))\n\n(defn throw-error-with-location\n  ([msg iobj] (throw-error-with-location msg iobj {}))\n  ([msg iobj data]\n   (let [{:keys [:line :column :file]\n          :or {file @vars/current-file}} (meta iobj)]\n     (throw (ex-info msg (merge {:type :sci/error\n                                 :line line\n                                 :column column\n                                 :file file} data))))))\n\n(def ^:dynamic *in-try* false)\n\n(defn macro? [f]\n  (when-let [m (meta f)]\n    (or (:sci/macro m)\n        (:macro m))))\n\n(def needs-ctx (symbol \"needs-ctx\"))\n\n#?(:cljs\n   (def allowed-append \"used for allowing interop in with-out-str\"\n     (symbol \"append\")))\n\n(defn rethrow-with-location-of-node\n  ([ctx ^Throwable e raw-node] (rethrow-with-location-of-node ctx (:bindings ctx) e raw-node))\n  ([ctx bindings ^Throwable e raw-node]\n   (if #?(:clj (or *in-try*\n                   (not= (:main-thread-id ctx)\n                         (.getId (Thread/currentThread))))\n          :cljs *in-try*) (throw e)\n       (let [stack (t/stack raw-node)\n             node (t/sexpr raw-node)\n             f (when (seqable? node)\n                 (first node))\n             fm (or (:sci.impl/f-meta stack)\n                    (some-> f meta))\n             env (:env ctx)\n             id (:id ctx)\n             d (ex-data e)\n             st (or (when-let [st (:sci.impl/callstack d)]\n                      st)\n                    (volatile! '()))]\n         (when stack\n           (when-not (:special stack)\n             #_(swap! env update-in [:sci.impl/callstack id]\n                    (fn [vt]\n                      (if vt\n                        (do (vswap! vt conj stack)\n                           vt)\n                        (volatile! (list stack)))))\n             (vswap! st conj stack)))\n         (let [d (ex-data e)\n               ;; st (:sci.impl/callstack d)\n               wrapping-sci-error? (isa? (:type d) :sci/error)]\n           (if wrapping-sci-error?\n             (throw e)\n             (let [ex-msg #?(:clj (.getMessage e)\n                             :cljs (.-message e))\n                   {:keys [:line :column :file]}\n                   (or stack\n                       (some-> env deref\n                               :sci.impl/callstack (get id)\n                               deref last meta)\n                       (meta node))]\n               (if (and line column)\n                 (let [ex-msg (if (and ex-msg (:name fm))\n                                (str/replace ex-msg #\"(sci\\.impl\\.)?fns/fun/[a-zA-Z0-9-]+--\\d+\"\n                                             (str (:ns fm) \"/\" (:name fm)))\n                                ex-msg)\n                       new-exception\n                       (let [new-d {:type :sci/error\n                                    :line line\n                                    :column column\n                                    :message ex-msg\n                                    :sci.impl/callstack\n                                    st\n                                    #_(delay (when-let\n                                               [v (get-in @(:env ctx) [:sci.impl/callstack (:id ctx)])]\n                                             @v))\n                                    :file file\n                                    :locals bindings}]\n                         (ex-info ex-msg new-d e))]\n                   (throw new-exception))\n                 (throw e)))))))))\n\n(defn- iobj? [obj]\n  (and #?(:clj (instance? clojure.lang.IObj obj)\n          :cljs (implements? IWithMeta obj))\n       (meta obj)))\n\n(defn vary-meta*\n  \"Only adds metadata to obj if d is not nil and if obj already has meta\"\n  [obj f & args]\n  (if (iobj? obj)\n    (apply vary-meta obj f args)\n    obj))\n\n(defn strip-core-ns [sym]\n  (case (namespace sym)\n    (\"clojure.core\" \"cljs.core\") (symbol (name sym))\n    sym))\n\n(def allowed-loop (symbol \"loop\"))\n(def allowed-recur (symbol \"recur\"))\n\n(defn walk*\n  [inner form]\n  (cond\n    (:sci.impl/op (meta form)) form\n    (list? form) (with-meta (apply list (map inner form))\n                   (meta form))\n    #?(:clj (instance? clojure.lang.IMapEntry form) :cljs (map-entry? form))\n    #?(:clj (clojure.lang.MapEntry/create (inner (key form)) (inner (val form)))\n       :cljs (MapEntry. (inner (key form)) (inner (val form)) nil))\n    (seq? form) (with-meta (doall (map inner form))\n                  (meta form))\n    #?(:clj (instance? clojure.lang.IRecord form)\n       :cljs (record? form))\n    (reduce (fn [r x] (conj r (inner x))) form form)\n    (coll? form) (into (empty form) (map inner form))\n    :else form))\n\n(defn prewalk\n  \"Prewalk with metadata preservation. Does not prewalk :sci.impl/op nodes.\"\n  [f form]\n  (walk* (partial prewalk f) (f form)))\n\n(defn namespace-object\n  \"Fetches namespaces from env if it exists. Else, if `create?`,\n  produces one regardless of the existince of the namespace in env and\n  adds it to env before returning it.\"\n  [env ns-sym create? attr-map]\n  (let [env* @env\n        ns-map (get-in env* [:namespaces ns-sym])]\n    (or (:obj ns-map)\n        (when (or ns-map create?)\n          (let [ns-obj (vars/->SciNamespace ns-sym attr-map)]\n            (swap! env assoc-in [:namespaces ns-sym :obj] ns-obj)\n            ns-obj)))))\n\n(defn set-namespace! [ctx ns-sym attr-map]\n  (let [env (:env ctx)\n        attr-map (merge (meta ns-sym) attr-map)\n        ns-obj (namespace-object env ns-sym true attr-map)]\n    (t/setVal vars/current-ns ns-obj)))\n\n(def eval-form-state (volatile! nil))\n(def eval-require-state (volatile! nil))\n(def eval-use-state (volatile! nil))\n(def eval-resolve-state (volatile! nil))\n(def eval-refer-state (volatile! nil))\n(def macroexpand* (volatile! nil))\n(def macroexpand-1* (volatile! nil))\n(def eval* (volatile! nil))\n(def eval-do* (volatile! nil))\n(def eval-fn (volatile! nil))\n(def eval-string* (volatile! nil))\n(def lookup (volatile! nil))\n\n(defn eval [sci-ctx form]\n  (@eval-form-state sci-ctx form))\n\n(defn split-when\n  \"Like partition-by but splits collection only when `pred` returns\n  a truthy value. E.g. `(split-when odd? [1 2 3 4 5]) => ((1 2) (3 4) (5))`\"\n  [pred coll]\n  (lazy-seq\n   (when-let [s (seq coll)]\n     (let [fst (first s)\n           f (complement pred)\n           run (cons fst (take-while #(f %) (next s)))]\n       (cons run (split-when pred (lazy-seq (drop (count run) s))))))))\n\n(def ana-macros\n  '#{do if and or let fn fn* def defn\n     comment loop lazy-seq case try defmacro\n     declare expand-dot* expand-constructor new . import in-ns ns var\n     set! resolve #_#_macroexpand-1 macroexpand})\n\n(defn ctx-fn\n  ([f expr]\n   (t/->EvalFn f nil expr nil))\n  ([f m expr]\n   (t/->EvalFn f m expr nil))\n  ([f m expr stack]\n   (t/->EvalFn f m expr stack)))\n\n(defn maybe-destructured\n  [params body]\n  (if (every? symbol? params)\n    {:params params\n     :body body}\n    (loop [params params\n           new-params (with-meta [] (meta params))\n           lets []]\n      (if params\n        (if (symbol? (first params))\n          (recur (next params) (conj new-params (first params)) lets)\n          (let [gparam (gensym \"p__\")]\n            (recur (next params) (conj new-params gparam)\n                   (-> lets (conj (first params)) (conj gparam)))))\n        {:params new-params\n         :body [`(let ~lets\n                   ~@body)]}))))\n\n(defn log [& xs]\n  #?(:clj (.println System/err (str/join \" \" xs))\n     :cljs (.log js/console (str/join \" \" xs))))\n"]}